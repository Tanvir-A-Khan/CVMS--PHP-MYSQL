<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "CVMS";

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                  CONNECTING WITH THE DATABASE
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


try {
  $conn = new PDO("mysql:host=$servername", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  $sql = "CREATE DATABASE CVMS";
  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Database created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage() . "<br>" ;
}

$conn = null;



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                  PARENT TABLE
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

try {
  $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // sql to create Parent table
  $sql = "CREATE TABLE Parents (
  pid INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  fathername VARCHAR(30) NOT NULL,
  mothername VARCHAR(30) NOT NULL,
  paddress VARCHAR(30) NOT NULL,
  pemail VARCHAR(30) NOT NULL,
  pphone VARCHAR(30) NOT NULL,
  pnid VARCHAR(30) NOT NULL,
  ppassword VARCHAR(30) NOT NULL,
  reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE (pemail),
  UNIQUE (pphone)

  )";

  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Table Parent created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                  CHILDREN TABLE
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/// Creating Children Table in CVMS
try {
  $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // sql to create Parent table
  $sql = "CREATE TABLE Childrens (
  cid INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  pid INT(6) UNSIGNED,
  cname VARCHAR(50),
  cbirthplace VARCHAR(30) NOT NULL,
  cbirthdate DATE NOT NULL,
  FOREIGN KEY (pid) REFERENCES Parents(pid)ON DELETE SET NULL,
  reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
  )";

  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Table Childrens created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                  CENTER TABLE
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/// Creating Centers Table in CVMS
try {
  $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // sql to create Centers table
  $sql = "CREATE TABLE Centers (
  centerid INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  centername VARCHAR(50),
  centeraddress VARCHAR(50),
  centerpassword VARCHAR(50),
  centeremail VARCHAR(50),
  reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE (centername)

  )";

  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Table Centers created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                 VACCINES TABLE
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/// Creating Vaccines Table in CVMS
try {
  $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // sql to create Vaccines table
  $sql = "CREATE TABLE Vaccines (
  vaccineid INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  centerid INT(6) UNSIGNED,
  vaccinename VARCHAR(55),
  vaccineamount INT(5),
  vaccinemanufacturer VARCHAR(50) NOT NULL,
  vaccineagelimit VARCHAR(50),
  vaccineprice INT(5),
  vaccinedose INT(5),
  vaccinedescription VARCHAR(255) NOT NULL,
  FOREIGN KEY (centerid) REFERENCES Centers(centerid) ON DELETE SET NULL,
  reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE(vaccinename)
  )";


  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Table Vaccines created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                  SCHEDULE VACCINES TABLE
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



/// Creating upcomingschedules table
try {
  $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // sql to create upcomingSchedule table
  $sql = "CREATE TABLE upcomingSchedule (
  uvaccineid INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  cid INT(6) UNSIGNED ,
  vaccinename VARCHAR(50),
  vaccinedose INT(3),
  vaccineprice INT(10),
  vaccinedate DATE NOT NULL,
  centername VARCHAR(50),
  isgiven VARCHAR(50),
  FOREIGN KEY (cid) REFERENCES Childrens(cid) ON DELETE SET NULL
  -- FOREIGN KEY (vaccinename) REFERENCES Vaccines(vaccinename) ON DELETE SET NULL
  )";

  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Table upcomingSchedule created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage();
}

/// Creating takenVaccines Table
try {
  $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
  // set the PDO error mode to exception
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // sql to create ScheduleVaccines table
  $sql = "CREATE TABLE takenVaccines (
  tvaccineid INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  cid INT(6) UNSIGNED ,
  vaccinename VARCHAR(50),
  vaccinedose INT(3),
  tvaccinedate DATE NOT NULL,
  centername VARCHAR(50),
  FOREIGN KEY (cid) REFERENCES Childrens(cid) ON DELETE SET NULL
  -- FOREIGN KEY (vaccinename) REFERENCES Vaccines(vaccinename) ON DELETE SET NULL,
  -- reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
  )";

  // use exec() because no results are returned
  $conn->exec($sql);
  echo "Table takenVaccines created successfully<br>";
} catch (PDOException $e) {
  // echo $sql . "<br>" . $e->getMessage();
}



$conn = null;


?>